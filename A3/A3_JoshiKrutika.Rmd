---
title: "Assignment Three"
author: "Krutika Joshi"
output:
  html_document:
    toc: true
    theme: united
bibliography: references.bib
---

# Introduction 

This study is based on the data set collected from GSE212591. The study focused on the efficacy of azacitidine and decitabine treatments for infant acute lymphoblastic leukemia (ALL). The data handling involved removing duplicates and unmapped genes and was followed by normalization using the Trimmed Mean of M-values (TMM). This was completed to ensure the data set can be compared across different library sizes and treatment conditions.

Using the normalized data, multidimensional scaling (MDS) and dispersion analysis was applied to assess the differential gene expression. MDS provided a visual representation of the treatment effects and showed different clustering of samples based on treatment type. The results showed significant differences in gene expression patterns among azacitidine and decitabine treatments. To elaborate more on the analysis, dispersion analysis further highlighted the variability in gene expression. There was a notably high differentially expressed genes in decitabine-treated samples compared to controls and azacitidine treatments. This suggested that using both decitabine and azacitidine may be helpful in treating ALL. 

G:Profiler was run on the data set to identify the up-regulated and down-regulated pathways. It was found that myeloid leukocyte activation was up-regulated and DNA-templated DNA replication was down regulated. Now, non-threshold analysis will be conducted to further analyse the data followed by graphing the network.

# Part 1: Non-thresholded Gene set Enrichment Analysis
```{r child = '../A2/A2_JoshiKrutika.Rmd'}
#path to GSEA jar 
gsea_jar <- "../GSEA_4.3.3/gsea-cli.sh"
working_dir <- "data/"
output_dir <- "./generated_data/"
analysis_name <- "azacitidine_vs_decitabine"

#compute ranks
qlf_output_hits_withgn <- as.data.frame(qlf_output_hits)
qlf_output_hits_withgn$rank <- -log(qlf_output_hits_withgn$PValue, base = 10) * sign(qlf_output_hits_withgn$logFC)
qlf_output_hits_withgn <- qlf_output_hits_withgn[order(qlf_output_hits_withgn$rank), ]

#sort table by ranks
qlf_output_hits_withgn <- qlf_output_hits_withgn[order(qlf_output_hits_withgn$rank, decreasing = TRUE),]
qlf_output_hits_withgn$gene_name <- rownames(qlf_output_hits_withgn)
rank_file <- qlf_output_hits_withgn[, c("gene_name", "rank")]
# Write it to a .rnk file
write.table(rank_file, file = "./data/azacitvsdecit_RNASeq_ranks.rnk", sep = "\t", quote = FALSE, row.names = FALSE)
rnk_file <- "azacitvsdecit_RNASeq_ranks.rnk"

run_gsea <- TRUE
dest_gmt_file = file.path(output_dir, "Human_GOBP_AllPathways_noPFOCR_with_GO_iea_March_01_2024_symbol.gmt")

# Run GSEA 
if(run_gsea){
  command <- paste("",gsea_jar,  
                   "GSEAPreRanked -gmx", dest_gmt_file, 
                   "-rnk" ,file.path(working_dir, rnk_file), 
                   "-collapse false -nperm 1000 -scoring_scheme weighted", 
                   "-rpt_label ",analysis_name,
                   "  -plot_top_x 20 -rnd_seed 12345  -set_max 200",  
                   " -set_min 15 -zip_report false ",
                   " -out" ,output_dir, 
                   " > gsea_output.txt",sep=" ")
  system(command)
}
```
1.) What method did you use? What genesets did you use? Make sure to specify versions and cite your methods.

- I used the GSEAPreRanked method that is part of the GSEA package [@subramanian_gene_2005 and @mootha_pgc-1-responsive_2003]. This method takes in a data file that already has the genes ranked (which is why it is named PreRanked). The ranking for each gene is based on the negative log of the P-value and sign of logFC value of azacitidine and decitabine. 

The gene set I used was a .gmt file taken from the Bader lab labeled as "Human_GOBP_AllPathways_noPFOCR_with_GO_iea_March_01_2024_symbol.gmt". Based on the title of these gene set, it is evident that the gene set pertains to humans. It contains Gene Ontology Biological Processes(GOBP) which can be used in identifying molecular functions. The keyword AllPathways suggests that all biological pathways are present.   

The version of GSEA I used was 4.3.3. The version of the gene set I used was dated March 1, 2024.  


2.) Summarize your enrichment results.

- Based on the results, there were 3089 gene sets that were up-regulated out of 5074. Out of the 3089 gene sets, only 421 gene sets had an FDR value of below 0.25. Identifying gene sets under this FDR value helps identify the pathways with stronger relevance. There were 257 genes set with p-value of less than 0.01 and 554 gene sets with p-value of 0.05. The up-regulated enrichment result stated LEUKOCYTE CHEMOTAXIS%GOBP%GO:0030595 as the top pathway. This pathway had an enrichment score of 0.79607016 which represents a significant over representation of this pathway compared to the other up-regulated genes. The FDR value received for this pathway is 0 which indicates that after correcting for multiple hypothesis testing, the significance is still high. 


- In terms of the down regulated gene sets, 1985 out of 5074 gene sets were down regulated. Out of the 1985, only 89 gene sets were significantly enriched at FDR value of 0.25. Which means about 89 gene sets were most likely significantly down regulated after correcting for multiple hypothesis testing. 97 gene sets were significantly enriched at the pvalue of 0.01 and 260 gene sets are significantly enriched at pvalue of 0.05. The top pathway that was downregulated was PROTEINOGENIC AMINO ACID METABOLIC PROCESS%GOBP%GO:0170039 with the ES of -0.68892586. This suggests that there is a significant under representation of this pathway compared to the other down-regulated genes. This has a FDR value of 0.001806672 which suggests a high significance of this pathway to down-regulation. 

3.) How do these results compare to the results from the thresholded analysis in Assignment #2. Compare qualitatively. Is this a straight forward comparison? Why or why not?

When comparing G:Profiler with GSEA, due to the methodologies and the gene sets used being different, I don't think the comparison is very straightforward. That being said there are some aspects that are straight forward such as finding the general theme.

For example, G:Profiler identified myeloid leukocyte activation as a top up-regulated gene set, while GSEA highlighted Leukocyte Chemotaxis. Both terms relate to the activation and movement of leukocytes, suggesting an increase in the immune response. Due to this common instance in both the G:Profiler and GSEA, it can we seen that the treatment appears to influence the immune system.Same with down regulation where G:Profiler said DNA-templated DNA replication pathway was down regulated meanwhile GSEA said proteinogenic amino acid metabolic process was down regulated. Both of these pathway seem to suggest reduction in the metabolic activities.

Now focusing on the complexities, G:Profiler and GSEA use different methods. G:Profiler looks at the overrepresentation of gene sets that is defined as upregulated or downregulated genes though a threshold value. But, GSEA does not use a threshold value and focuses on the enrichment value instead. This allows GSEA to examine genes without the needed to state if they are up or down regulated. Now focusing on the interpretation of the data, although the results might suggest an overall theme, the specific pathways vary. Like for example leukocyte chemotaxis implies recruitment of immune cells to a specific infected location but myeloid leukocyte activation indicates a general upregulation of immune cells activity. 

# Part 2: Visualize your Gene set Enrichment Analysis in Cytoscape

![Enrichhment Map showing azacitidine vs decitabine](./figure/EnrichmentMap.png)

1.) Using your results from your non-thresholded gene set enrichment analysis visualize your results in Cytoscape. Create an enrichment map - how many nodes and how many edges in the resulting map? What thresholds were used to create this map? Make sure to record all thresholds. Include a screenshot of your network prior to manual layout.

- There are 74 nodes and 134 edges in the map. The threshold used for the node cut off was 0.05 and the edge cut of was 0.375. All the other parameters were set to default. The image above shows the map before any layout manipulation. 

Nodes in the map represent gene sets. The node size represents the number of genes in the gene set and the edges represent overlap between gene sets. The thicker the edge, the higher the number of genes that overlap between the two nodes. The legend is red represents Azacitidine and blue represents Decitabine. 

2.) Annotate your network - what parameters did you use to annotate the network. If you are using the default parameters make sure to list them as well.

![Enrichhment Map showing azacitidine vs decitabine with grouped gene sets](./figure/EnrichmentMapGrouped.svg)
For the creation of the clustered image, I used the default parameters present. The clustering algorithm used is MCL Clustering with the edge weight option as similarity_coefficeint. The max word per labels were 3 and the min word label was 1. The adjacent word bonus was set to 8. In addition, I clicked on the "Publication-Ready" option so that question 3 is completed. 

3.) Make a publication ready figure - include this figure with proper legends in your notebook.

- Attached in the second image 

4.) Collapse your network to a theme network. What are the major themes present in this analysis? Do they fit with the model? Are there any novel pathways or themes?

![Theme network](./figure/ThemeNetwork.svg)

- The major theme present in this network are chemotaxis neurophil migration, organization extracurricular matrix and mitochondrial gene translation. These pathways do fit the model as these pathways seem to have a large overlap in the general theme of increased immune response and decresed DNA replication. 

- Some of the pathways are upregulated and others are down regulated. There are some novel pathways such as organization extracurricular matrix and mitochondrial gene translation but there are some old pathways too such as chemotaxis neurophil migration. There are some pathways which are very similar on the clustered table versus the theme network. For example, tissue migration epithelial is present in the clustered pathway network meanwhile tissue migration amebodial is present in the theme network. Both of them are very similar to each other but they do have a notable difference. Overall there seems to be a large overlap between the pathways in the clustered network and the theme network which shows a promising fit within the model. 


